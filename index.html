<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>С Днем Рождения!</title>
    <style>
        :root {
            --bg-color: #f0f4f8;
            --box-color: #ff6b6b;
            --ribbon-color: #ffd93d;
            --cake-color: #f8a5c2;
            --icing-color: #ffeaa7;
            --text-color: #4a4e69;
        }

        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle, #ffffff 0%, #dde1e7 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        #scene {
            position: relative;
            width: 100vmin;
            height: 100vmin;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- ЭТАП 1: КОРОБКА --- */
        .gift-container {
            position: absolute;
            width: 150px;
            height: 150px;
            cursor: pointer;
            transition: transform 0.3s;
            z-index: 10;
        }

        .gift-container:hover {
            animation: shake 0.5s infinite;
        }

        @keyframes shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-5deg); }
            100% { transform: rotate(0deg); }
        }

        .box-body {
            position: absolute;
            bottom: 0;
            width: 150px;
            height: 120px;
            background-color: var(--box-color);
            border-radius: 0 0 10px 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .box-body::before { /* Лента вертикальная */
            content: '';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 100%;
            background-color: var(--ribbon-color);
        }

        .box-lid {
            position: absolute;
            top: 0;
            left: -10px;
            width: 170px;
            height: 40px;
            background-color: #ff5252;
            border-radius: 5px;
            z-index: 2;
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
            transition: transform 0.5s ease-out;
        }

        .box-lid::before { /* Лента на крышке */
            content: '';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 100%;
            background-color: var(--ribbon-color);
        }

        .click-hint {
            position: absolute;
            bottom: -40px;
            width: 100%;
            text-align: center;
            color: #888;
            font-weight: bold;
            animation: pulse 1s infinite alternate;
        }

        @keyframes pulse {
            from { opacity: 0.6; transform: scale(1); }
            to { opacity: 1; transform: scale(1.1); }
        }

        /* Анимации открытия коробки */
        .gift-container.open .box-lid {
            transform: translateY(-100px) rotate(-20deg);
            opacity: 0;
        }

        .gift-container.open .box-body {
            animation: fadeOutBox 0.5s forwards 0.3s;
        }

        .gift-container.open .click-hint {
            display: none;
        }

        @keyframes fadeOutBox {
            to { transform: scale(0); opacity: 0; }
        }

        /* --- КОНФЕТТИ --- */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
        }

        /* --- ЭТАП 2: ТОРТ --- */
        .cake-container {
            position: absolute;
            width: 200px;
            height: 200px;
            display: none; /* Скрыт по умолчанию */
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            z-index: 5;
        }

        .cake-base {
            width: 180px;
            height: 100px;
            background-color: var(--cake-color);
            border-radius: 10px;
            position: relative;
            box-shadow: inset -10px 0 rgba(0,0,0,0.05);
        }

        .cake-icing {
            position: absolute;
            top: 0;
            left: -5px;
            width: 190px;
            height: 40px;
            background-color: var(--icing-color);
            border-radius: 20px;
            z-index: 2;
        }

        .cake-icing::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 10px;
            width: 20px;
            height: 20px;
            background-color: var(--icing-color);
            border-radius: 50%;
            box-shadow: 30px 0 var(--icing-color), 60px 0 var(--icing-color), 90px 0 var(--icing-color), 120px 0 var(--icing-color), 150px 0 var(--icing-color);
        }

        /* Анимация падения и переворота торта */
        .cake-animate-enter {
            display: flex;
            animation: dropAndFlip 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes dropAndFlip {
            0% {
                transform: translateY(-500px) rotate(180deg);
                opacity: 0;
            }
            60% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            80% {
                transform: translateY(-20px) rotate(-5deg);
            }
            100% {
                transform: translateY(0) rotate(0deg);
            }
        }

        /* --- СВЕЧИ --- */
        .candles-wrapper {
            position: absolute;
            top: -40px; /* Позиция над тортом */
            width: 100%;
            height: 50px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .candle {
            width: 12px;
            height: 40px;
            background: repeating-linear-gradient(45deg, #6c5ce7, #6c5ce7 5px, #fff 5px, #fff 10px);
            position: relative;
            opacity: 0; /* Скрыты */
            transform: translateY(-200px);
        }

        .flame {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 10px;
            height: 15px;
            background-color: #fdcb6e;
            border-radius: 50% 50% 20% 20%;
            animation: flicker 0.5s infinite alternate;
            opacity: 0;
        }

        @keyframes flicker {
            from { transform: translateX(-50%) scale(1); }
            to { transform: translateX(-50%) scale(1.1); opacity: 0.8; }
        }

        .candle-fall {
            animation: dropCandle 0.6s ease-out forwards;
        }

        @keyframes dropCandle {
            0% { transform: translateY(-200px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        /* --- ЭТАП 3: ТЕКСТ И КОЛПАК --- */
        .final-message {
            position: absolute;
            top: 15%;
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0;
            transform: scale(0.5);
            z-index: 20;
        }

        .final-message h1 {
            font-size: 4rem;
            color: var(--text-color);
            text-transform: uppercase;
            text-shadow: 2px 2px 0px #fff;
            margin: 0;
            text-align: center;
            line-height: 1.1;
        }

        .final-message.show {
            animation: popText 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes popText {
            to { opacity: 1; transform: scale(1); }
        }

        /* Колпак */
        .party-hat {
            position: absolute;
            top: -100px; /* Начало выше экрана */
            width: 0;
            height: 0;
            border-left: 30px solid transparent;
            border-right: 30px solid transparent;
            border-bottom: 70px solid #00cec9;
            opacity: 0;
            transform: rotate(15deg);
            z-index: 25;
        }

        .party-hat::after {
            content: '';
            position: absolute;
            bottom: -75px;
            left: -32px;
            width: 64px;
            height: 10px;
            background: #fdcb6e;
            border-radius: 50%;
        }

        .party-hat.drop {
            animation: dropHat 0.8s ease-out forwards;
        }

        @keyframes dropHat {
            0% { top: -200px; opacity: 0; transform: rotate(0deg); }
            60% { top: 50px; opacity: 1; transform: rotate(360deg); }
            100% { top: 100px; opacity: 1; transform: rotate(380deg); }
        }

    </style>
</head>
<body>

    <div id="scene">
        <!-- ЭТАП 1: Коробка -->
        <div class="gift-container" id="giftBox" onclick="startSurprise()">
            <div class="box-lid"></div>
            <div class="box-body"></div>
            <div class="click-hint">Нажми меня!</div>
        </div>

        <!-- ЭТАП 2: Торт -->
        <div class="cake-container" id="cake">
            <div class="candles-wrapper">
                <div class="candle" id="c1"><div class="flame"></div></div>
                <div class="candle" id="c2"><div class="flame"></div></div>
                <div class="candle" id="c3"><div class="flame"></div></div>
            </div>
            <div class="cake-icing"></div>
            <div class="cake-base"></div>
        </div>

        <!-- ЭТАП 3: Текст -->
        <div class="final-message" id="message">
            <h1>Happy<br>Birthday</h1>
        </div>
        
        <!-- Колпак (отдельно от текста) -->
        <div class="party-hat" id="hat"></div>
    </div>

    <script>
        function startSurprise() {
            const box = document.getElementById('giftBox');
            
            // 1. Убираем клик, чтобы не нажать дважды
            box.onclick = null;
            box.style.cursor = 'default';

            // 2. Анимация открытия коробки
            box.classList.add('open');

            // 3. Запуск конфетти (сразу при открытии)
            fireConfetti();

            // 4. Удаляем коробку и запускаем торт
            setTimeout(() => {
                box.style.display = 'none';
                showCake();
            }, 800); // Ждем пока коробка исчезнет
        }

        function createConfettiParticle() {
            const colors = ['#eb4d4b', '#f0932b', '#f6e58d', '#6ab04c', '#4834d4', '#be2edd'];
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');
            
            // Случайный цвет
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            
            // Позиция в центре
            confetti.style.left = '50%';
            confetti.style.top = '50%';
            
            // Случайное направление вылета
            const angle = Math.random() * Math.PI * 2;
            const velocity = 100 + Math.random() * 200; // Расстояние полета
            const tx = Math.cos(angle) * velocity;
            const ty = Math.sin(angle) * velocity;
            
            // Анимация через Web Animation API для динамических значений
            confetti.animate([
                { transform: 'translate(-50%, -50%) scale(0)', opacity: 1 },
                { transform: `translate(calc(-50% + ${tx}px), calc(-50% + ${ty}px)) scale(1) rotate(${Math.random()*360}deg)`, opacity: 0 }
            ], {
                duration: 1000 + Math.random() * 500,
                easing: 'cubic-bezier(0.25, 1, 0.5, 1)',
                fill: 'forwards'
            });

            document.getElementById('scene').appendChild(confetti);

            // Удаляем элемент после анимации
            setTimeout(() => confetti.remove(), 1500);
        }

        function fireConfetti() {
            // Создаем 60 частиц
            for(let i=0; i<60; i++) {
                setTimeout(createConfettiParticle, i * 10);
            }
        }

        function showCake() {
            const cake = document.getElementById('cake');
            // Показываем контейнер и добавляем класс анимации (падение и переворот)
            cake.style.display = 'flex';
            cake.classList.add('cake-animate-enter');

            // После того как торт упал, запускаем свечи
            setTimeout(() => {
                dropCandles();
            }, 1200); // 1.2s длится анимация торта
        }

        function dropCandles() {
            const c1 = document.getElementById('c1');
            const c2 = document.getElementById('c2');
            const c3 = document.getElementById('c3');

            // Падают по очереди
            c1.classList.add('candle-fall');
            
            setTimeout(() => {
                c2.classList.add('candle-fall');
            }, 300);

            setTimeout(() => {
                c3.classList.add('candle-fall');
            }, 600);

            // Зажигаем огонь после падения последней
            setTimeout(() => {
                document.querySelectorAll('.flame').forEach(f => f.style.opacity = 1);
                showFinalText();
            }, 1200);
        }

        function showFinalText() {
            const msg = document.getElementById('message');
            const hat = document.getElementById('hat');

            // Показываем текст
            msg.classList.add('show');

            // Колпак падает прямо на надпись
            setTimeout(() => {
                hat.classList.add('drop');
                // Позиционируем колпак по центру надписи
                const msgRect = msg.getBoundingClientRect();
                const sceneRect = document.getElementById('scene').getBoundingClientRect();
                hat.style.left = (msgRect.left + msgRect.width/2 - sceneRect.left - 30) + 'px';
            }, 500);
        }

    </script>
</body>
</html>
